<!DOCTYPE html>
<html lang="en" x-init="init()">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/echarts@latest/dist/echarts.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <title>Zerver</title>
  </head>

  <body
    x-data="{ page: 'ecommerce', 'loaded': true, 'darkMode': true, 'stickyMenu': false, 'sidebarToggle': false, 'scrollTop': false, 'logs': false, 'health': false, 'performance': false, 'security': false }"
    x-init="
         darkMode = JSON.parse(localStorage.getItem('darkMode'));
         $watch('darkMode', value => localStorage.setItem('darkMode', JSON.stringify(value)))"
    :class="{'dark text-bodydark bg-boxdark-2': darkMode === true}"
  >
    <include src="./partials/preloader.html"></include>
    <div class="flex h-screen overflow-hidden">
      <include src="./partials/sidebar.html"></include>
      <div
        class="relative flex flex-1 flex-col overflow-y-auto overflow-x-hidden"
      >
        <include src="./partials/header.html" />
        <main>
          <div class="mx-auto max-w-screen-2xl p-4 md:p-6 2xl:p-10">
            <div class="mb-10">
              <div
                class="relative rounded-sm border border-stroke bg-white py-6 px-5.5 dark:border-strokedark dark:bg-boxdark"
              >
                <div
                  class="loader"
                  x-show="$store.analysis.loading"
                  style="
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                  "
                >
                  <!-- Replace this with your actual loader or spinner element -->
                  Loading...
                </div>
                <div
                  class="rounded-sm border border-stroke bg-white py-3 shadow-default dark:border-strokedark dark:bg-boxdark"
                  id="log-estimation-forecast"
                  style="width: 100%; height: 600px"
                >
                  <!-- Your chart or content goes here -->
                </div>
              </div>
            </div>
            <div class="mb-10">
              <div
                class="rounded-sm border border-stroke bg-white py-6 px-5.5 dark:border-strokedark dark:bg-boxdark"
              >
                <div
                  class="rounded-sm border border-stroke bg-white py-3 shadow-default dark:border-strokedark dark:bg-boxdark"
                  id="user-estimation-forecast"
                  style="width: 100%; height: 600px"
                ></div>
              </div>
            </div>
            <div class="grid grid-cols-2">
              <div
                class="rounded-sm border border-stroke bg-white py-6 px-5.5 dark:border-none dark:bg-boxdark"
              >
                <h1
                  class="text-3xl font-bold text-lavendar3 dark:text-lavendar2"
                >
                  Cost Estimation
                </h1>
                <p
                  x-text="'$ ' + $store.analysis.costEstimation"
                  class="text-2xl"
                ></p>
              </div>

              <div
                class="rounded-sm border border-stroke bg-white py-6 px-5.5 dark:border-l-4  dark:bg-boxdark"
              >
                <p class="text-2xl">
                  For now today 12/18/2023, Using previous Data
                </p>
              </div>
            </div>
            <div class="mt-10 grid grid-cols-2">
              <div
              class="rounded-sm border border-stroke bg-white py-6 px-5.5 dark:border-none dark:bg-boxdark"
              >
              <p class="text-2xl">
                For now today 12/18/2023, Using previous Data
                
              </p>
              </div>
              <div
                class="rounded-sm border border-stroke bg-white py-6 px-5.5 dark:border-none dark:bg-boxdark"
              >
                <h1
                  class="text-3xl font-bold text-lavendar3 dark:text-lavendar2"
                >
                  Daily User Forecast
                </h1>
                <p
                  x-text="$store.analysis.userForecast"
                  class="text-2xl"
                ></p>
              </div>
            </div>
            <div class="mt-10 grid grid-cols-2">
              <div
                class="rounded-sm border border-stroke bg-white py-6 px-5.5 dark:border-none dark:bg-boxdark"
              >
                <h1
                  class="text-3xl font-bold text-lavendar3 dark:text-lavendar2"
                >
                Log Estimation
              </h1>
                <p
                  x-text="JSON.stringify($store.analysis.logEstimation)"
                  class="text-2xl"
                ></p>
              </div>
              <div
                class="rounded-sm border border-stroke bg-white py-6 px-5.5 dark:border-none dark:bg-boxdark"
              >
              <p class="text-2xl">
                  For now today 12/18/2023, Using previous Data
                </p>
              </div>
            </div>
            <div class="flex w-[100%] items-center justify-center">
              <div
                class="mt-5 w-fit rounded-sm border border-stroke bg-white py-6 px-5.5 dark:border-none dark:bg-boxdark"
              >
                <h1
                  class="text-center text-3xl font-bold text-lavendar3 dark:text-lavendar2"
                >
                  Check IP's Genuineness
                </h1>
                <div class="mt-10 flex items-center justify-center">
                  <div class="cr8dw2" data-aos="fade-down">
                    <a
                      class="cfhua c272e cpm5o c8isz c0z2s c1mpe ccqfq cit3o cx3jz cgi3a cqxsj c27r3 coqcu cfl4k c1xwr cq2yg"
                      style="width: 100px; height: 50px"
                      href="#0"
                    >
                      <span class="c2sao cwban c27r3" onclick="trigger()">
                        Check
                      </span>
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>
    <!-- <script> -->
      <script src="./js/components/logEstimationForecast.js"></script>
      <script src="./js/components/userEstimationForecast.js"></script>
      <!-- </script> -->
      <script>
        document.addEventListener("alpine:init", () => {
          Alpine.store("analysis", {
            costEstimation: Alpine.$persist("12.3444"),
            userForecast: Alpine.$persist("90.1212"),
          logEstimation: Alpine.$persist("9.2323"),
          loading: Alpine.$persist(false),
        });
        const soc = io("http://localhost:3001");
        
        soc.on("costEstimation1", (msg) => {
          console.log(msg); 
          try {
            Alpine.store("analysis").costEstimation = msg.data.yhat;
          } catch (err) {
            console.log(err);
          }
        });

        soc.on("userForecast1", (msg) => {
          console.log(msg);
          try {
            Alpine.store("analysis").userForecast = msg.data.yhat;
          } catch (err) {
            console.log(err);
          }
        });
        console.log(Alpine.store("analysis").userForecast);

        soc.on("logEstimation1", (msg) => {
          console.log(msg);
          try {
            Alpine.store("analysis").logEstimation = msg.data.yhat;
          } catch (err) {
            console.log(err);
          }
        });
      });
      document.addEventListener("DOMContentLoaded", function () {

        Alpine.store("analysis").loading = true;
        
        
        if(Alpine.store("analysis").userForecast != null){
          Alpine.store("analysis").loading = false;
       }
      });


      function trigger() {
        Swal.fire({
          title: "Enter the IP address",
          input: "text",
          inputAttributes: {
            autocapitalize: "off",
          },
          showCancelButton: true,
          confirmButtonText: "Look up",
          showLoaderOnConfirm: true,
          preConfirm: async (ipAddress) => {
            try {
              return new Promise((resolve, reject) => {
                const sock = io("http://localhost:3001");
                console.log(ipAddress);
                sock.emit("checkIp", ipAddress);
                sock.on("ipStatus", (data) => {
                  resolve(data);
                });

                sock.on("ipError", (error) => {
                  reject(error);
                });
              });
            } catch (error) {
              throw new Error(`Request failed: ${error}`);
            }
          },
          allowOutsideClick: () => !Swal.isLoading(),
        })
          .then((result) => {
            confirmButtonColor: "#3085d6";
            console.log(result);

            Swal.fire({
              title: "IP Status",
              text: result.value.data.status,
            });
          })
          .catch((error) => {
            Swal.fire({
              icon: "error",
              title: "Error",
              text: "An error occurred",
            });
          });
      }
      function init() {
            // Check if it's a browser reload
            if (performance.navigation.type === 1) {
                // Alpine.store('analysis').userForecast = null;
                // Alpine.store('analysis').costEstimation = null;
                // Alpine.store('analysis').logEstimation  = null;
                // Alpine.store('analysis').loading = false;
                
            }
            
        }
    </script>
  </body>
</html>
